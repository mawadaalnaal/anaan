<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- تعطيل الترجمة التلقائية لتقليل طلبات gstatic -->
  <meta name="google" content="notranslate" />

  <!-- سياسة الأمان CSP: ضعها أول عنصر داخل <head> ولا تكرر أي وسم CSP آخر -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'self';
    img-src 'self' data: https:;
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline' https:;
    style-src-elem 'self' 'unsafe-inline' https:;
    font-src 'self' data: https:;
    frame-src 'self' blob: data:;
    connect-src 'self';
    object-src 'none';
    frame-ancestors 'none';
    upgrade-insecure-requests;
  ">

  <title>مشاريع - عنان</title>

  <!-- تحسين تحميل الخطوط -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- خط Amiri -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <!-- ملفات التنسيقات المحلية (تأكد من صحة الأسماء والمسارات) -->
  <link rel="stylesheet" href="summary.css">
  <link rel="stylesheet" href="Projects.css">
</head>
<body>
  <!-- الهيدر -->
  <header class="header">
    <div class="container">
      <div class="logo-container">
        <img src="img/لوغو%20فاتح.png" alt="لوغو عنان" class="logo-image">
      </div>
      <nav class="nav">
        <ul>
          <li><a href="index.html">الرئيسية</a></li>
          <li><a href="quotations.html">الاقتباسات</a></li>
          <li><a href="summary.html">التلخيص</a></li>
          <li><a href="documentation.html">التوثيق</a></li>
          <li><a href="videos.html">الفيديوهات</a></li>
          <li><a href="tahfizat.html">تحفيزات</a></li>
          <li><a href="projects.html">مشاريع</a></li>
          <li><a href="team.html">أعضاء الفريق</a></li>
        </ul>
      </nav>
      <button class="menu-toggle" aria-label="فتح القائمة"><i class="fa-solid fa-bars"></i></button>
    </div>
  </header>

  <!-- قسم المشاريع -->
  <section class="projects-wrap" id="Projects" dir="rtl">
    <h2 class="projects-title">مشاريع</h2>
    <div class="projects-grid">

      <!-- كارت مشروع -->
      <article class="project-card">
        <!-- ملاحظة: لأن اسم الملف فيه مسافة، يجب ترميزها بـ %20 -->
        <img src="مشاريع/مشروع%201.jpg" class="project-image" alt="مشروع 1">
        <div class="project-actions">
          <!-- عدّلنا اسم الـPDF إلى project-1.pdf حسب ما ذكرت -->
          <a class="btn" href="مشاريع/project-1.pdf" download>
            <i class="fa-solid fa-download"></i> تحميل
          </a>

          <!-- زر عرض داخل مودال -->
          <button type="button" class="btn view-btn" data-pdf="مشاريع/project-1.pdf" aria-label="مشاهدة">
            <i class="fa-solid fa-eye"></i> مشاهدة
          </button>
        </div>
      </article>

      <!-- يمكنك تكرار الكارت لمشاريع أخرى مع تغيير المسارات -->
      <!--
      <article class="project-card">
        <img src="مشاريع/مشروع%202.jpg" class="project-image" alt="مشروع 2">
        <div class="project-actions">
          <a class="btn" href="مشاريع/project-2.pdf" download><i class="fa-solid fa-download"></i> تحميل</a>
          <button type="button" class="btn view-btn" data-pdf="مشاريع/project-2.pdf"><i class="fa-solid fa-eye"></i> مشاهدة</button>
        </div>
      </article>
      -->

    </div>
  </section>

  <!-- مودال PDF -->
  <div class="pdf-modal" id="pdfModal" aria-hidden="true">
    <div class="pdf-modal__dialog">
      <div class="pdf-modal__header">
        <h3 id="pdfTitle">عرض الملف</h3>
        <div class="pdf-modal__tools">
          <a id="modalDownloadBtn" class="btn small" href="#" download>
            <i class="fa-solid fa-download"></i> تحميل
          </a>
          <button class="btn small ghost" id="modalCloseBtn" aria-label="إغلاق">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
      <div class="pdf-modal__body">
        <iframe id="pdfViewer" class="pdf-frame" src="" title="PDF Viewer"></iframe>
        <p style="padding:10px">
          إذا لم يظهر الملف يمكنك
          <a id="fallbackDownload" href="#" download>تحميله من هنا</a>.
        </p>
      </div>
    </div>
  </div>

  <!-- الفوتر -->
  <footer class="footer" id="contact">
    <div class="social-links">
      <a href="https://t.me/al3nan_12" target="_blank" class="social-link" rel="noopener"><i class="fab fa-telegram"></i></a>
      <a href="https://x.com/alananteam" target="_blank" class="social-link" rel="noopener"><i class="fab fa-x-twitter"></i></a>
      <a href="https://www.instagram.com/alanan.team" target="_blank" class="social-link" rel="noopener"><i class="fab fa-instagram"></i></a>
    </div>
    <p class="copyright">
      <a href="https://mawadaalnaal.github.io/portfolio/" target="_blank" rel="noopener">
        جميع الحقوق محفوظة © 2025 Mawadda Alnaal
      </a>
    </p>
  </footer>

  <!-- سكربت -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // قائمة الموبايل
    const menuToggle = document.querySelector('.menu-toggle');
    if (menuToggle) {
      menuToggle.addEventListener('click', () => {
        const navList = document.querySelector('.nav ul');
        if (navList) navList.classList.toggle('show');
      });
    }

    const modal            = document.getElementById('pdfModal');
    const viewer           = document.getElementById('pdfViewer');
    const modalDownload    = document.getElementById('modalDownloadBtn');
    const fallbackDownload = document.getElementById('fallbackDownload');
    const closeBtn         = document.getElementById('modalCloseBtn');

    // فحص وجود الملف قبل الفتح لتجنب مودال فارغ
    async function exists(url) {
      try {
        const r = await fetch(url, { method: 'HEAD' });
        return r.ok;
      } catch (e) {
        console.error('Fetch HEAD failed for', url, e);
        return false;
      }
    }

    function openPdfModal(pdfUrl) {
      viewer.setAttribute('src', pdfUrl);
      modalDownload.setAttribute('href', pdfUrl);
      fallbackDownload.setAttribute('href', pdfUrl);
      modal.classList.add('show');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closePdfModal() {
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden', 'true');
      viewer.setAttribute('src', '');
      document.body.style.overflow = '';
    }

    if (closeBtn) closeBtn.addEventListener('click', closePdfModal);
    if (modal) {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closePdfModal();
      });
    }
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closePdfModal();
    });

    // تشغيل زر المشاهدة
    document.body.addEventListener('click', async (e) => {
      const btn = e.target.closest('.view-btn');
      if (!btn) return;

      e.preventDefault();
      const pdfUrl = btn.getAttribute('data-pdf');
      if (!pdfUrl) {
        console.warn('data-pdf مفقود على الزر', btn);
        return;
      }

      // فتح تبويب جديد على الشاشات الصغيرة / iOS
      const isSmall = window.matchMedia('(max-width:640px)').matches;
      const isIOS   = /iPad|iPhone|iPod/i.test(navigator.userAgent);

      const ok = await exists(pdfUrl);
      if (!ok) {
        alert('تعذّر العثور على الملف. تحقق من الاسم/المسار (حسّاس لحالة الأحرف).');
        console.error('404 for', pdfUrl);
        return;
      }

      if (isSmall || isIOS) {
        window.open(pdfUrl, '_blank', 'noopener');
        return;
      }

      openPdfModal(pdfUrl);
    });
  });
  </script>
</body>
</html>
